<!DOCTYPE html><html lang="null"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>Runtime | stack.blog</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/6.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Runtime</h1><a id="logo" href="/.">stack.blog</a><p class="description"></p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> Start</i></a><a href="/archives/"><i class="fa fa-archive"> Archiv</i></a><a href="/about/"><i class="fa fa-user"> Über</i></a><a href="/atom.xml"><i class="fa fa-rss"> RSS</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Runtime</h1><div class="post-meta">Apr 17, 2017<span> | </span><span class="category"><a href="/categories/Runtime/">Runtime</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><div class="post-content"><h2 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h2><p>Objective-C是一门动态语言,它将很多静态语言在编译和链接时做的事放到运行时处理,意味着OC不仅需要编译器,还需要一个运行时系统来执行编译代码.<br>Runtime版本:modern和legacy,我们现在用的就是modern版.<br>Runtime基本是用C和汇编写的,对于C语言，函数的调用在编译的时候会决定调用哪个函数，编译完成之后直接顺序执行.<br>OC的函数调用成为消息发送。属于动态调用过程。在编译的时候并不能决定真正调用哪个函数（事实证明，在编 译阶段，OC可以调用任何函数，即使这个函数并未实现，只要申明过就不会报错。而C语言在编译阶段就会报错)只有在真正运行的时候才会根据函数的名称找 到对应的函数来调用.</p>
<h2 id="二-OC-的方法调用"><a href="#二-OC-的方法调用" class="headerlink" title="二.OC 的方法调用"></a>二.OC 的方法调用</h2><p>objc_msgSend(self.xxx,@selector(xxx));</p>
<h2 id="三-实例"><a href="#三-实例" class="headerlink" title="三.实例"></a>三.实例</h2><p>所有类的信息都可以在动态加载中获取,readonly 属性也可以修改</p>
<ol>
<li><p>修改变量</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">unsigned int count = 0;  </div><div class="line">Ivar *ivar = class_copyIvarList([self.person class], &amp;count);  </div><div class="line">for (int i = 0; i &lt; count; i++) &#123;  </div><div class="line">    Ivar var = ivar[i];  </div><div class="line">    const char *varName = ivar_getName(var);  </div><div class="line">    NSString *name = [NSString stringWithUTF8String:varName];  </div><div class="line">    NSLog(@&quot;------%@&quot;,name);  </div><div class="line">    if ([name isEqualToString:@&quot;_name&quot;]) &#123;  </div><div class="line">        object_setIvar(self.person, var, @&quot;李四&quot;);  </div><div class="line">        break;  </div><div class="line">    &#125;  </div><div class="line">&#125;  </div><div class="line">NSLog(@&quot;person name class : %@&quot;,self.person.name);   `</div></pre></td></tr></table></figure>
</li>
<li><p>交换方法<br>交换的方法如果没有实现的话, 不会有任何效果;<br>传入ClassA而方法确传入其他类的方法也不会有任何效果;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">Method m1 = class_getInstanceMethod([self.person class], @selector(firstMethod));  </div><div class="line">Method m2 = class_getInstanceMethod([self.person class], @selector(secondMethod));  </div><div class="line">method_exchangeImplementations(m1, m2);</div></pre></td></tr></table></figure>
</li>
<li><p>动态添加方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">//(IMP)guessAnswer 意思是guessAnswer的地址指针;  </div><div class="line">//&quot;v@:&quot; 意思是，v代表无返回值void，如果是i则代表int；@代表 id sel; : 代表 SEL _cmd;  </div><div class="line">//“v@:@@” 意思是，两个参数的没有返回值。  </div><div class="line">class_addMethod([self.person class], @selector(test), (IMP)testMethod, &quot;v@:&quot;);  </div><div class="line">if ([self.person respondsToSelector:@selector(test)]) &#123;  </div><div class="line">    [self.person performSelector:@selector(test)];  </div><div class="line">&#125; else &#123;  </div><div class="line">    NSLog(@&quot;Sorry,I don&apos;t know&quot;);  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>添加属性,Category 中也可以</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">NSString *chineseName = @&quot;every one&quot;;  </div><div class="line">objc_setAssociatedObject(self, &amp;aName, chineseName, OBJC_ASSOCIATION_COPY_NONATOMIC);  </div><div class="line">NSString *associated = objc_getAssociatedObject(self, &amp;aName);  </div><div class="line">self.textLabel.text = associated;</div></pre></td></tr></table></figure>
</li>
<li><p>获取其他类中的方法(针对于静态库)可以获取到方法名,参数个数,返回值类型,参数名暂时未获取到</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">- (void)scanStaticLibraryMethod  </div><div class="line">&#123;  </div><div class="line">    unsigned int count = 0;  </div><div class="line">    Method *methods = class_copyMethodList([self.library class], &amp;count);  </div><div class="line">    for (int i = 0; i &lt; count; i++) &#123;  </div><div class="line">        //方法名  </div><div class="line">        NSString *methodName = [NSString stringWithCString: sel_getName(method_getName(methods[i]))encoding: NSASCIIStringEncoding];  </div><div class="line">        Method aMethod = methods[i];  </div><div class="line">        //返回值类型  </div><div class="line">        char *returnType = method_copyReturnType(aMethod);  </div><div class="line">        NSString *type = [NSString stringWithUTF8String:returnType];  </div><div class="line">        //返回参数和返回值类型  </div><div class="line">        const char *methodParameter = method_getTypeEncoding(aMethod);  </div><div class="line">        NSString *methodParameterName = [NSString stringWithUTF8String:methodParameter];  </div><div class="line">        //参数个数  </div><div class="line">        unsigned paramCount = method_getNumberOfArguments(aMethod);  </div><div class="line">        //每个参数类型  </div><div class="line">        for (int i = 0; i &lt; paramCount; i++) &#123;  </div><div class="line">        char *paramType = method_copyArgumentType(aMethod, i);  </div><div class="line">        NSLog(@&quot;当前方法名为:%@,此方法共有%d个参数,当前是第%d个参数,参数类型为:%@,返回值类型为:%@, 参数和返回值类型:%@&quot;,methodName, paramCount, i, [NSString stringWithUTF8String:paramType], type, methodParameterName);  </div><div class="line">        &#125;  </div><div class="line">    &#125;  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ol>
<p>当前方法名为:modifyAddress:,此方法共有3个参数,当前是第0个参数,参数类型为:@,返回值类型为:v, 参数和返回值类型:v24@0:8@16<br>当前方法名为:modifyAddress:,此方法共有3个参数,当前是第1个参数,参数类型为::,返回值类型为:v, 参数和返回值类型:v24@0:8@16<br>当前方法名为:modifyAddress:,此方法共有3个参数,当前是第2个参数,参数类型为:@,返回值类型为:v, 参数和返回值类型:v24@0:8@16  </p>
<h2 id="如何理解-v24-0-8-16"><a href="#如何理解-v24-0-8-16" class="headerlink" title="如何理解 v24@0:8@16?**"></a>如何理解 v24@0:8@16?**</h2><p>OC的对象指针占位8个字节<br>v 表示返回值类型 void; B 表示返回值类型为 bool….<br>24表示整个方法参数占位的总长度<br>@0表示在 offset 为0的地方有个 object-c 的对象,在 object-c method 里首个对象是 self 自身<br>:8在 offset 为8的地方有一个 SEL<br>@16表示在 offset 为16的地方有一个 object-c 对象<br>@表示就是 object-c 对象,数字是内存位置,内存对齐原则</p>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="https://github.com/songMW/stack.github.io/2017/04/17/Runtime/" data-id="cj28qs8jb0004ugortk6ochf5" class="article-share-link">Aktie</a><div class="tags"><a href="/tags/Objective-C/">Objective-C</a></div><div class="post-nav"><a href="/2017/04/12/python3FroMac/" class="pre">python3ForMac</a><a href="/2017/04/18/unrecognizedSelector/" class="next">unrecognizedSelector</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="https://github.com/songMW/stack.github.io"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> Kategorien</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/BasicOperators/">BasicOperators</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Class-dump/">Class-dump</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/GracefulSentence/">GracefulSentence</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Hello-World/">Hello World</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Hexo-github/">Hexo+github</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Runtime/">Runtime</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/TheBasic/">TheBasic</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/iOS常见错误收集/">iOS常见错误收集</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/iOS常见错误收集/Xcode编译错误集合/">Xcode编译错误集合</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/iOS常见错误收集/arm指令集错误收集/">arm指令集错误收集</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/iOS常见错误收集/崩溃日志/">崩溃日志</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/python3FroMac/">python3FroMac</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/unrecognizedSelector/">unrecognizedSelector</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> Tags</i></div><div class="tagcloud"><a href="/tags/Sentence/" style="font-size: 15px;">Sentence</a> <a href="/tags/Swift/" style="font-size: 15px;">Swift</a> <a href="/tags/Objective-C/" style="font-size: 15px;">Objective-C</a> <a href="/tags/Installation/" style="font-size: 15px;">Installation</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> Letzte</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/05/03/GracefulSentence/">GracefulSentence</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/26/arm指令集/">arm指令集错误收集</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/25/崩溃日志/">崩溃日志</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/21/Class-dump/">Objective-C Class-dump</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/20/Swift-BasicOperators/">Swift.BasicOperators</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/19/Swift-TheBasic/">TheBasic</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/18/unrecognizedSelector/">unrecognizedSelector</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/17/Runtime/">Runtime</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/12/python3FroMac/">python3ForMac</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/11/hello-world/">Hello World</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> Blogroll</i></div><ul></ul><a href="http://www.example1.com/" title="site-name1" target="_blank">site-name1</a><ul></ul><a href="http://www.example2.com/" title="site-name2" target="_blank">site-name2</a><ul></ul><a href="http://www.example3.com/" title="site-name3" target="_blank">site-name3</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2017 <a href="/." rel="nofollow">stack.blog.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.0.47/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.0.47/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>