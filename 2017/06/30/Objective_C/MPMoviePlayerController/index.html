<!DOCTYPE html>
<html lang="zh-CN">
  <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <meta name="description" content="null">
  <meta name="keyword" content="undefined">
  
    <link rel="icon" href="">
  
    
  <title>MPMoviePlayerController | stack.blog</title>
  <link rel="stylesheet" href="/style.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.1.20/jquery.fancybox.min.css" />
</head>

<body>
  <header>
  <div class="header-container">
    <a class='logo' href="/">
      <span>stack.blog</span>
    </a>
    <ul class="right-header">
      
        <li class="nav-item">
          
            <a href="/" class="item-link">首页</a>
          
        </li>
      
        <li class="nav-item">
          
            <a href="/about" class="item-link">关于</a>
          
        </li>
      
        <li class="nav-item">
          
            <a href="/archives" class="item-link">归档</a>
          
        </li>
      
        <li class="nav-item">
          
            <a href="/tags" class="item-link">标签</a>
          
        </li>
      
    </ul>
  </div>
</header>

  <main id='post'>
  <div class="content">
    <article>
        <section class="content markdown-body">
          <h1>MPMoviePlayerController</h1>
          <div class='post-meta'>
            <i class="fa fa-calendar" aria-hidden="true"></i> <time>2017年06月30日</time>
            
              | <i class="fa fa-folder-open-o" aria-hidden="true"></i> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/Objective-C/">Objective-C</a>/ <a class="article-category-link" href="/categories/Objective-C/AVFoundation/">AVFoundation</a>/ <a class="article-category-link" href="/categories/Objective-C/AVFoundation/MoviePlayer/">MoviePlayer</a>/ <a class="article-category-link" href="/categories/Objective-C/AVFoundation/MoviePlayer/MPMoviePlayerController/">MPMoviePlayerController</a>
  </div>



            
            
              | 
                  <i class="fa fa-tag" aria-hidden="true"></i>
                
               
  <a href="/tags/#Objective-C" class='tag'>Objective-C</a>


            
          </div>
          <p>首先贴上<a href="https://developer.apple.com/documentation/mediaplayer/mpmovieplayercontroller" target="_blank" rel="external">官方文档</a></p>
<h2 id="1-初始化"><a href="#1-初始化" class="headerlink" title="1. 初始化"></a>1. 初始化</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">- (void)viewDidLoad</div><div class="line">&#123;</div><div class="line">    [super viewDidLoad];</div><div class="line"></div><div class="line">    [self.view addSubview:self.moviePlayerController.view];</div><div class="line">    [self.moviePlayerController.view makeConstraints:^(MASConstraintMaker *make) &#123;</div><div class="line">        make.top.left.bottom.right.equalTo(self.view);</div><div class="line">    &#125;];</div><div class="line">    [self.moviePlayerController prepareToPlay];</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (MPMoviePlayerController *)moviePlayerController</div><div class="line">&#123;</div><div class="line">    if (!_moviePlayerController) &#123;</div><div class="line">        _moviePlayerController = [[MPMoviePlayerController alloc]init];</div><div class="line">        _moviePlayerController.fullscreen = NO;</div><div class="line">        _moviePlayerController.controlStyle = MPMovieControlStyleEmbedded;</div><div class="line">        _moviePlayerController.scalingMode = MPMovieScalingModeAspectFit;</div><div class="line">        [_moviePlayerController.view setTranslatesAutoresizingMaskIntoConstraints:NO];</div><div class="line">    &#125;</div><div class="line">    return _moviePlayerController;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>_moviePlayerController.view 一定要添加到父视图上, 要不只有声音没有图片</li>
<li>MPMoviePlayerController 继承 NSObject <mpmediaplayback></mpmediaplayback></li>
<li><mpmediaplayback> 播放, 暂停, 停止, 准备播放的API</mpmediaplayback></li>
<li>视图刚呈现时底部显示: 暂停 进度条 全屏按钮</li>
<li>点击底部全屏按钮后会在顶部呈现: Done 进度条 退出全屏按钮</li>
</ul>
<h2 id="2-顶部-Done-和-退出全屏按钮的监测"><a href="#2-顶部-Done-和-退出全屏按钮的监测" class="headerlink" title="2. 顶部 Done 和 退出全屏按钮的监测"></a>2. 顶部 Done 和 退出全屏按钮的监测</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">[[NSNotificationCenter defaultCenter] addObserver:self selector:@selector(doneButtonClick:) name:MPMoviePlayerWillExitFullscreenNotification object:nil];</div><div class="line"></div><div class="line">- (void)doneButtonClick:(NSNotification *)center</div><div class="line">&#123;</div><div class="line">    if (self.moviePlayerController.playbackState == MPMoviePlaybackStateStopped) &#123;</div><div class="line">        //说明是点击Done按钮</div><div class="line">        [self dismissViewControllerAnimated:YES completion:nil];</div><div class="line">    &#125;</div><div class="line">    else if (self.moviePlayerController.playbackState == MPMoviePlaybackStatePlaying)&#123;</div><div class="line">        //说明点击了右上角退出全屏按钮</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>注册 <code>MPMoviePlayerWillExitFullscreenNotification</code> 这个通知, 不管是点击Done还是退出全屏按钮都会接受到通知, 在通知的回调方法中可以根据 <code>playbackState</code> 这个属性来判断是点击那个按钮.</li>
<li>点击Done按钮时会暂停播放</li>
<li>点击退出全屏按钮则不会暂停播放</li>
</ul>
<h2 id="3-监听视频播放结束"><a href="#3-监听视频播放结束" class="headerlink" title="3. 监听视频播放结束"></a>3. 监听视频播放结束</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">[[NSNotificationCenter defaultCenter] addObserver:self selector:@selector(videoEndPlay:) name:MPMoviePlayerPlaybackDidFinishNotification object:nil];</div><div class="line"></div><div class="line">- (void)videoEndPlay:(NSNotification *)sender</div><div class="line">&#123;</div><div class="line">    NSLog(@&quot;播放结束&quot;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>自动播放完成后会调用</li>
<li>用户退出播放时会调用</li>
</ul>
<h2 id="4-监听当前视频播放状态"><a href="#4-监听当前视频播放状态" class="headerlink" title="4. 监听当前视频播放状态"></a>4. 监听当前视频播放状态</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">[[NSNotificationCenter defaultCenter] addObserver:self selector:@selector(videoLoadStateDidChange:) name:MPMoviePlayerLoadStateDidChangeNotification object:nil];</div><div class="line">- (void)videoLoadStateDidChange:(NSNotification *)sender</div><div class="line">&#123;</div><div class="line">    // Returns the network load state of the movie player</div><div class="line">    switch (self.moviePlayerController.loadState) &#123;</div><div class="line">        case MPMovieLoadStatePlayable:</div><div class="line">            NSLog(@&quot;加载完成,可以播放&quot;);</div><div class="line">            break;</div><div class="line"></div><div class="line">        case MPMovieLoadStatePlaythroughOK:</div><div class="line">            NSLog(@&quot;缓冲完成，可以连续播放&quot;);</div><div class="line">            break;</div><div class="line"></div><div class="line">        case MPMovieLoadStateStalled:</div><div class="line">            NSLog(@&quot;缓冲中&quot;);</div><div class="line">            break;</div><div class="line"></div><div class="line">        case MPMovieLoadStateUnknown:</div><div class="line">            NSLog(@&quot;未知状态&quot;);</div><div class="line">            break;</div><div class="line"></div><div class="line">        default:</div><div class="line">            break;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="5-监听当前视频-Playback-拖动进度条-播放-暂停-开启全屏-退出全屏也需要注册这个通知"><a href="#5-监听当前视频-Playback-拖动进度条-播放-暂停-开启全屏-退出全屏也需要注册这个通知" class="headerlink" title="5. 监听当前视频 Playback 拖动进度条, 播放, 暂停, 开启全屏, 退出全屏也需要注册这个通知"></a>5. 监听当前视频 Playback 拖动进度条, 播放, 暂停, 开启全屏, 退出全屏也需要注册这个通知</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line">[[NSNotificationCenter defaultCenter] addObserver:self selector:@selector(videoPlaybackDidChange:) name:MPMoviePlayerPlaybackStateDidChangeNotification object:nil];</div><div class="line"></div><div class="line">- (void)videoPlaybackDidChange:(NSNotification *)center</div><div class="line">&#123;</div><div class="line">    switch (self.moviePlayerController.playbackState) &#123;</div><div class="line">        case MPMoviePlaybackStateStopped:</div><div class="line">            NSLog(@&quot;停止播放&quot;);</div><div class="line">            break;</div><div class="line"></div><div class="line">        case MPMoviePlaybackStatePlaying:</div><div class="line">            NSLog(@&quot;正在播放&quot;);</div><div class="line">            break;</div><div class="line"></div><div class="line">        case MPMoviePlaybackStatePaused:</div><div class="line">            NSLog(@&quot;暂停播放&quot;);</div><div class="line">            break;</div><div class="line"></div><div class="line">        case MPMoviePlaybackStateInterrupted:</div><div class="line">            NSLog(@&quot;中断播放&quot;);</div><div class="line">            break;</div><div class="line"></div><div class="line">        case MPMoviePlaybackStateSeekingForward:</div><div class="line">            NSLog(@&quot;快进&quot;);</div><div class="line">            break;</div><div class="line"></div><div class="line">        case MPMoviePlaybackStateSeekingBackward:</div><div class="line">            NSLog(@&quot;快退&quot;);</div><div class="line">            break;</div><div class="line"></div><div class="line">        default:</div><div class="line">            break;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="7-上一首-下一首"><a href="#7-上一首-下一首" class="headerlink" title="7. 上一首, 下一首"></a>7. 上一首, 下一首</h2><h2 id="8"><a href="#8" class="headerlink" title="8."></a>8.</h2>
        </section>
    </article>
    
        
  </div>
  <aside>
    
    <div class="toc-container">
        <h1>目录</h1>
        <div class="content">
            <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-初始化"><span class="toc-number">1.</span> <span class="toc-text">1. 初始化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-顶部-Done-和-退出全屏按钮的监测"><span class="toc-number">2.</span> <span class="toc-text">2. 顶部 Done 和 退出全屏按钮的监测</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-监听视频播放结束"><span class="toc-number">3.</span> <span class="toc-text">3. 监听视频播放结束</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-监听当前视频播放状态"><span class="toc-number">4.</span> <span class="toc-text">4. 监听当前视频播放状态</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-监听当前视频-Playback-拖动进度条-播放-暂停-开启全屏-退出全屏也需要注册这个通知"><span class="toc-number">5.</span> <span class="toc-text">5. 监听当前视频 Playback 拖动进度条, 播放, 暂停, 开启全屏, 退出全屏也需要注册这个通知</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-上一首-下一首"><span class="toc-number">6.</span> <span class="toc-text">7. 上一首, 下一首</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8"><span class="toc-number">7.</span> <span class="toc-text">8.</span></a></li></ol>
        </div>
    </div>
    
  </aside>
</main>



  <footer>
  <div class="copyright">
    <div>
      &copy; 2018 | Powered by <a href="https://hexo.io" target="_blank">Hexo</a>&nbsp
    </div>
    <div>
      Theme by <a href="https://github.com/lewis-geek/hexo-theme-Aath" target="_blank">Aath</a>
    </div>
  </div>
</footer>


<script src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
<script src="/lib/in-view.min.js"></script>
<script src="/lib/lodash.min.js"></script>
<script>
  var isDown = true
  var oldY = 0
  inView.offset(50)

  document.body.addEventListener('touchstart', function(){});
  
  window.addEventListener('scroll', _.throttle(e => {
    var currentY = window.scrollY
    if((oldY - currentY) < 0) {
      isDown = true
    } else {
      isDown = false
    }
    oldY = currentY
  }, 250))

  $("article img").each(function() {
      var strA = "<a data-fancybox='gallery' href='" + this.src + "'></a>";
      $(this).wrapAll(strA);
  });

  $('.toc-link').each(function() {
      var href = $(this).attr("href");
      
      inView(href).on('exit', () => {
        if (isDown) {
          handleActive(href)
        }
      })

      inView(href).on('enter', () => {
        if (!isDown) {
          handleActive(href)
        }
      })

      this.onclick = function(e) {
        var pos = $(href).offset().top - 10;
        $("html,body").animate({scrollTop: pos}, 300);
        setTimeout(() => {
          handleActive(href)
        }, 350)
        return false
      }
  })

  function handleActive(href) {
    document.querySelectorAll('.toc-link').forEach(elm => {
      elm.classList.remove('active')
    })
    document.querySelector(".toc [href='"+ href +"']").classList.add('active')
  }
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.1.20/jquery.fancybox.min.js"></script>


</body>
</html>
